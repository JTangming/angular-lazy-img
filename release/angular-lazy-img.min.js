angular.module("angularLazyImg",[]),angular.module("angularLazyImg").factory("LazyImgMagic",["$window","$rootScope","lazyImgConfig","lazyImgHelpers",function(e,n,t,r){"use strict";function o(){for(var e=h.length-1;e>=0;e--){var n=h[e];n&&r.isElementInView(n.$elem[0],I.offset,m)&&(u(n),h.splice(e,1))}h.length||s()}function i(e){d.forEach(function(n){n[e]("scroll",z),n[e]("touchmove",z)}),f[e]("resize",z),f[e]("resize",p)}function a(){y=!0,setTimeout(function(){o(),i("on")},1)}function s(){y=!1,i("off")}function c(e){var n=h.indexOf(e);-1!==n&&h.splice(n,1)}function u(e){var t=new Image;t.onerror=function(){I.errorClass&&e.$elem.addClass(I.errorClass),e.errorSrc&&l(e.$elem,e.errorSrc),n.$emit("lazyImg:error",e),I.onError(e)},t.onload=function(){l(e.$elem,e.src),I.successClass&&e.$elem.addClass(I.successClass),n.$emit("lazyImg:success",e),I.onSuccess(e)},t.src=e.src}function l(e,n){"img"===e[0].nodeName.toLowerCase()?e[0].src=n:e.css("background-image",'url("'+n+'")')}function g(e){this.$elem=e}var m,f,h,y,I,z,p,d;return h=[],y=!1,I=t.getOptions(),f=angular.element(e),m=r.getWinDimensions(),p=r.throttle(function(){m=r.getWinDimensions()},60),I.container=I.containers||I.container,d=I.container?[].concat(I.container):[f],z=r.throttle(o,30),g.prototype.setSource=function(e){this.src=e,h.unshift(this),a()},g.prototype.setErrorSource=function(e){this.errorSrc=e},g.prototype.removeImage=function(){c(this),0===h.length&&s()},g.prototype.checkImages=function(){o()},g.addContainer=function(e){s(),d.push(e),a()},g.removeContainer=function(e){s(),d.splice(d.indexOf(e),1),a()},g}]),angular.module("angularLazyImg").provider("lazyImgConfig",function(){"use strict";this.options={offset:100,errorClass:null,successClass:null,onError:function(){},onSuccess:function(){}},this.$get=function(){var e=this.options;return{getOptions:function(){return e}}},this.setOptions=function(e){angular.extend(this.options,e)}}),angular.module("angularLazyImg").factory("lazyImgHelpers",["$window",function(e){"use strict";return{isElementInView:function(e,n,t){var r=e.getBoundingClientRect();return r.left<=t.width+n&&r.right>=0-n&&r.top<=t.height+n&&r.bottom>=0-n},getWinDimensions:function(){return{height:e.innerHeight,width:e.innerWidth}},throttle:function(e,n,t){var r,o;return function(){var i=t||this,a=+new Date,s=arguments;r&&a<r+n?(clearTimeout(o),o=setTimeout(function(){r=a,e.apply(i,s)},n)):(r=a,e.apply(i,s))}}}}]),angular.module("angularLazyImg").directive("lazyImg",["$rootScope","LazyImgMagic",function(e,n,t){"use strict";return{link:function(r,o,i){r.lazyImage=new t(o);var a=i.$observe("lazyImg",function(e){e&&(a(),r.lazyImage.setSource(e))});r.$on("$destroy",function(){if(r.lazyImage.removeImage(),e.lazyImgRefreshEvents){for(var n=0;n<e.lazyImgRefreshEvents.length;n++)e.lazyImgRefreshEvents[n]();e.lazyImgRefreshEvents=[]}}),e.$on("lazyImg.runCheck",function(){n.warn("Deprecated. Use lazyImg:refresh instead"),r.lazyImage.checkImages()}),e.$on("lazyImg:refresh",function(){r.lazyImage.checkImages()})},restrict:"A"}}]).directive("lazyImgError",[function(){"use strict";return{link:function(e,n,t){var r=e.$watch("lazyImage",function(e){e.setErrorSource(t.lazyImgError),r()});$rootScope.lazyImgRefreshEvents||($rootScope.lazyImgRefreshEvents=[]),$rootScope.lazyImgRefreshEvents.push($rootScope.$on("lazyImg:refresh",function(){lazyImage.checkImages()}))},restrict:"A"}}]).directive("lazyImgContainer",["LazyImgMagic",function(e){"use strict";return{link:function(n,t){e.addContainer(t),n.$on("$destroy",function(){e.removeContainer(t)})},restrict:"A"}}]);